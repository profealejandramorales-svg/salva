<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Uniforme - Inspector√≠a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        .main-wrapper { max-width: 1000px; margin: 0 auto; padding: 2rem; }
        .card { background-color: white; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; }
        
        /* Checkbox personalizado */
        .check-group {
            display: flex; align-items: center; gap: 8px;
            padding: 8px; border: 1px solid #e5e7eb; rounded: 6px;
            cursor: pointer; transition: all 0.2s;
        }
        .check-group:hover { background-color: #fff7ed; border-color: #fdba74; }
        .check-group input:checked + span { font-weight: bold; color: #c2410c; }

        /* ESTILOS DE IMPRESI√ìN (Colilla Vertical) */
        @media print {
            @page { size: portrait; margin: 0; }
            body > *:not(#printable-area) { display: none !important; }
            #printable-area { 
                display: block !important; 
                visibility: visible !important; 
                position: absolute; top: 0; left: 0; width: 80mm; /* Ancho impresora t√©rmica o recorte */
                padding: 5mm;
                font-family: 'Courier New', monospace;
            }
            .ticket-line { border-bottom: 1px dashed #000; margin: 5px 0; }
            .ticket-header { text-align: center; margin-bottom: 10px; }
            .ticket-title { font-size: 14px; font-weight: bold; text-transform: uppercase; }
            .ticket-info { font-size: 12px; margin-bottom: 5px; }
            .ticket-items { font-size: 11px; margin: 10px 0; }
            .ticket-footer { text-align: center; font-size: 10px; margin-top: 15px; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div id="message-box" class="fixed top-5 right-5 bg-orange-600 text-white px-6 py-3 rounded shadow-lg hidden transition-opacity z-50 font-bold"></div>

    <div class="main-wrapper">
        
        <div class="flex items-center justify-between mb-6 border-b pb-4 bg-white p-4 rounded-xl shadow-sm">
            <div class="flex items-center gap-4">
                <img src="logo.jpg" class="h-16 w-auto object-contain bg-gray-50 rounded-full p-1 border" onerror="this.style.display='none'">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Control de Uniforme</h1>
                    <p class="text-xs text-gray-500 font-medium">Registro de Presentaci√≥n Personal</p>
                </div>
            </div>
            <a href="index.html" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 font-bold text-sm">Volver</a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div class="card border-t-4 border-orange-500">
                <h2 class="text-lg font-bold text-gray-800 border-b pb-2 mb-4">Nueva Observaci√≥n</h2>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Curso</label>
                            <select id="course-select" class="w-full p-2 border rounded bg-gray-50 text-sm outline-none focus:ring-2 focus:ring-orange-200">
                                <option value="">-- Seleccionar --</option>
                            </select>
                        </div>
                        <div>
                             <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Fecha</label>
                             <input type="date" id="reg-date" class="w-full p-2 border rounded bg-gray-50 text-sm outline-none">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Estudiante</label>
                        <select id="student-select" class="w-full p-2 border rounded bg-gray-50 text-sm outline-none focus:ring-2 focus:ring-orange-200" disabled>
                            <option value="">Selecciona curso primero</option>
                        </select>
                    </div>

                    <div class="bg-orange-50 p-3 rounded border border-orange-100">
                        <label class="block text-xs font-bold text-orange-800 uppercase mb-2">Infracciones (Marcar)</label>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <label class="check-group"><input type="checkbox" value="Polera/Poler√≥n inadecuado" class="item-check"> <span>Polera/Poler√≥n</span></label>
                            <label class="check-group"><input type="checkbox" value="Pantal√≥n/Falda corto/ajustado" class="item-check"> <span>Pantal√≥n/Falda</span></label>
                            <label class="check-group"><input type="checkbox" value="Cabello largo/te√±ido/desordenado" class="item-check"> <span>Cabello</span></label>
                            <label class="check-group"><input type="checkbox" value="Uso de Piercing/Joyas" class="item-check"> <span>Piercing/Joyas</span></label>
                            <label class="check-group"><input type="checkbox" value="Maquillaje/U√±as pintadas" class="item-check"> <span>Maquillaje/U√±as</span></label>
                            <label class="check-group"><input type="checkbox" value="Barba/Afeitado" class="item-check"> <span>Barba/Afeitado</span></label>
                            <label class="check-group"><input type="checkbox" value="Sin cotona/delantal" class="item-check"> <span>Sin Cotona</span></label>
                            <label class="check-group"><input type="checkbox" value="Zapatos inadecuados" class="item-check"> <span>Zapatos</span></label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Observaci√≥n Adicional</label>
                        <input type="text" id="obs-text" class="w-full p-2 border rounded text-sm outline-none" placeholder="Detalle espec√≠fico...">
                    </div>

                    <button id="btn-save" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded shadow transition transform active:scale-95 mt-2 flex justify-center items-center gap-2">
                        <span>üñ®Ô∏è</span> Guardar e Imprimir Colilla
                    </button>
                </div>
            </div>

            <div class="card border-t-4 border-gray-500 flex flex-col h-full">
                <div class="flex justify-between items-center border-b pb-2 mb-2">
                    <h2 class="text-lg font-bold text-gray-800">Registros del D√≠a</h2>
                    <span class="text-xs bg-gray-200 px-2 py-1 rounded text-gray-600" id="count-badge">0</span>
                </div>
                
                <div class="flex-1 overflow-y-auto max-h-[500px]">
                    <table class="w-full text-left text-sm" id="report-table">
                        <thead class="bg-gray-50 sticky top-0 z-10 text-xs uppercase text-gray-500">
                            <tr>
                                <th class="p-2 border-b">Alumno</th>
                                <th class="p-2 border-b">Faltas</th>
                                <th class="p-2 border-b text-right"></th>
                            </tr>
                        </thead>
                        <tbody id="report-body" class="divide-y divide-gray-100">
                            <tr><td colspan="3" class="p-4 text-center text-gray-400 italic">Cargando...</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <button onclick="printReport()" class="mt-4 bg-gray-800 text-white text-xs font-bold py-2 rounded hover:bg-gray-900 w-full">
                    Imprimir Reporte General
                </button>
            </div>
        </div>
    </div>

    <div id="printable-area" class="hidden"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, where, Timestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyBnSMVCH0yyYUWk5z54kTIPTrWkyoeWs-I", authDomain: "suspenciones-40d0c.firebaseapp.com", projectId: "suspenciones-40d0c", storageBucket: "suspenciones-40d0c.firebasestorage.app", messagingSenderId: "853418739042", appId: "1:853418739042:web:d051befb99cd2acdd4583b" };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const COLLECTION_NAME = "uniforme_infracciones";

        // N√ìMINA (Misma base de datos que usas en los otros archivos)
        const schoolData = {
            'Primero Medio A': ['√ÅLVAREZ FA√öNDEZ MATEO VICENTE', 'CASTILLO ARAVENA MAITE PASCAL', 'COLLADO PUENTES SANTINO ALEXANDER', 'CONCHA TORREALBA JOAQU√çN IGNACIO', 'D√çAZ MALUENDA ESTEFAN√çA ANTONIA', 'DONAIRE ROJAS MAITE EMILIA ESTER', 'ESPINOZA CACHA√ëA LISBET ALEXANDRA', 'FERRADA ALBORNOZ AGUST√çN ALEXIS', 'FUENTEMAVIDA BARROS OSCAR ANTONIO', 'JAQUE PACHECO DAMI√ÅN IGNACIO', 'JARAMILLO VILLAR MATT HOST', 'L√ìPEZ ACU√ëA MARCO EMILIO', 'L√ìPEZ VILLAR FRANCO IGNACIO', 'MESA D√çAZ GONZALO IGNACIO', 'MEZA CARRASCO CRISTIAN ALFONSO', 'MORALES GARRIDO NICOL√ÅS ANTONIO', 'ORTEGA DA SILVA EMILIA CATALINA SOPHIA', 'PEREIRA TAPIA KEVIN RUB√âN', 'RAM√çREZ SEP√öLVEDA LUIS JUSTIN JES√öS', 'RAM√çREZ VALD√âS MARTINA POLETTE', 'RECABAL Y√Å√ëEZ TOM√ÅS IGNACIO', 'RODR√çGUEZ SEP√öLVEDA SIMONEY ISAMAR', 'ROJAS √ìRDENES TRACY MAIDEN', 'S√ÅNCHEZ MUNIZAGA ALONDRA ANA√çS', 'SOLIZ OLGUIN BRAYAN', 'VALENZUELA MU√ëOZ MAGDALENA BEL√âN'],
            'Segundo Medio A': ['ALBURQUENQUE DEL GRECCO EMILYA ANTONIA', 'ANABAL√ìN BELTR√ÅN BENJAM√çN NICOL√ÅS', 'ARAVENA Z√ö√ëIGA NOEM√ç JES√öS DE LAS ESTRELLAS', 'ARAYA DOM√çNGUEZ ALEX FABI√ÅN', 'ASTUDILLO CAMPOS CRIST√ìBAL ANTONIO', 'ASTUDILLO V√ÅSQUEZ BRUNO FERNANDO LE√ìN', 'BAEZ DONOSO LUKAS ALFONSO', 'CARO BUSTOS KRISCHNA ESTEFANIA', 'CONTRERAS SALGADO HADEEY ALEJANDRA', 'CUMINAO VIDAL CATALINA ANDREA', 'D√çAZ MALUENDA MIGUEL ALBERTO', 'IB√Å√ëEZ GONZ√ÅLEZ FERNANDA MAGDALENA', 'KILTAN GONZ√ÅLEZ DIDIER EZEQUIEL', 'LAGOS LASTRA ALEXANDRA DANAE', 'L√ìPEZ L√ìPEZ LUCIANO ANTONIO', 'L√ìPEZ NOVOA EYDAN DAMI√ÅN', 'MALDONADO FLORES ANTONELLA BEL√âN', 'MONTECINO D√çAZ VALESKA BEL√âN', 'MOYA REYES MATEO ANTONIO BENJAM√çN', 'MU√ëOZ CONTRERAS LUIS GABRIEL', 'MU√ëOZ LUNA ROGER JOEL', 'NAVARRO VILLANUEVA KARLA PAZ', 'ORELLANA ARRIAGADA SEBASTI√ÅN ANDR√âS', 'OSES CAMPOS VALENTINA ABIGAIL', 'PALMA ORELLANA ANTONELLA FRANCISCA', 'PEREIRA ORELLANA MONSERRAT ALAMIRA', 'P√âREZ ORMAZ√ÅBAL ZADKA ALEJANDRA', 'P√âREZ QUEVEDO CONSTANZA TRINIDAD', 'QUEZADA NARANJO FELIPE ALONSO', 'RAM√çREZ VILLALOBOS DUVAN EMILIO', 'RIQUELME SANTOS BENJAM√çN ALONSO', 'ROJAS GONZ√ÅLEZ FLORENCIA TRINIDAD', 'ROJAS LEIVA EDUARDO JAVIER', 'SALAZAR SALAS PEDRO JOS√â', 'SANTANDER L√ìPEZ MAR√çA JOS√â', 'TAPIA CASTILLA JEANFRANCO PATRICK', 'URBINA C√ÅCERES FRANCHESCA POULETTE', 'VARGAS MORAGA MARTINA SAYEN', 'V√ÅSQUEZ AGUILERA SCARLET NICOLE', 'V√ÅSQUEZ ZALDUENDO AMANDA ISABEL', 'VERA BRAVO FLORENCIA ANTONIA', 'Y√Å√ëEZ GONZ√ÅLEZ BRAYAN DAMI√ÅN', 'ZABALAGA COFR√â DAMI√ÅN ANDR√âS'],
            'Tercero Medio A': ['AHUMADA ROJAS TRINIDAD BEL√âN', 'CORNEJO CASTILLO OSCAR GABRIEL', 'ESPINOZA PE√ëALILLO BRAYAN JES√öS', 'FA√öNDEZ NORAMBUENA ALEJANDRO ANTONIO', 'JARAMILLO VILLAR EMILIO SCOTT', 'L√ìPEZ VILLAR MART√çN ALONSO', 'MEZA COLIM√ÅN ANGEL BLAS', 'MIRANDA MU√ëOZ ALEXANDRA JAVIERA', 'MORAGA PACHECO RENATO IGNACIO', 'MORALES REIM√ÅN ALFONSO TOM√ÅS', 'ORELLANA GARRIDO MAT√çAS LEANDRO', 'PEREIRA HORMAZ√ÅBAL MAXIMILIANO EDUARDO', 'PINTO TOBAR JORD√ÅN AMARO', 'RECABAL Y√Å√ëEZ KEVIN ANDR√âS', 'SANDOVAL CERPA VICENTE ESTEBAN', 'SOTO NARANJO CHRISTOPHER', 'VEKARIC VERDEJO MART√çN', 'VIELMA ZABALAGA JOAN MANUEL'],
            'Tercero Medio C': ['BRAVO MENARES ALEX JOHAN', 'CARRASCO LEIVA BENJAM√çN IGNACIO', 'ENCINA PIZARRO DIEGO BENJAM√çN ALEXANDER', 'ESPINOSA TORRES FERNANDA ELENA', 'GONZ√ÅLEZ SALAZAR EMILIA CATALINA', 'MEDEL OJEDA LE√ìN IGNACIO', 'OLIVARES VALENZUELA ALONSO IGNACIO', 'OLIVARES VALENZUELA ANTONELLA DANAE IGNACIA', 'PUNOY MEDEL MILLARAY ANG√âLICA', 'QUI√ëENAO MU√ëOZ CRIST√ìBAL PATRICIO', 'RIQUELME CASTILLO MAT√çAS EDUARDO ANTONIO', 'RIQUELME COLOMA DALIA CONSTANZA', 'RIVERA ABARZA CONSTANZA VICTORIA', 'SAAVEDRA BRAVO FLORENCIA ALEJANDRA', 'SALGADO ROJAS VICENTE MOIS√âS', 'SANTIS CASSEUS TEIVA SCARLETT', 'SOBARZO Y√âVENES KATHERINNE ALEXIA BEL√âN', 'TOLEDO ALBORNOZ ANTONELLA INES', 'VENEGAS ARRIAGADA ANTONIA EDITH'],
            'Cuarto Medio A': ['ALC√ÅNTAR GARC√çA MARTINA ALEJANDRA', 'BAHAMONDE MU√ëOZ ARIEL LEON', 'CAMPOS MU√ëOZ CRISTOPHER JES√öS', 'CANCINO OR√ìSTICA VICENTE GASPAR', 'CARO URRUTIA CONSUELO ANTONIA', 'CARRASCO GONZ√ÅLEZ CAMILA ANDREA', 'COFR√â CASTILLO ANTONIO ANDR√âS', 'GALDAMES VERGARA FELIPE ESTEBAN', 'GARC√çA GONZ√ÅLEZ SANTIAGO HUMBERTO', 'GONZ√ÅLEZ AMIGO FRANCISCA IGNACIA', 'GONZ√ÅLEZ SALAZAR JOAQU√çN ALONSO', 'GUTI√âRREZ GUTI√âRREZ ANGEL MART√çN', 'HERN√ÅNDEZ SEP√öLVEDA VICENTE ALEJANDRO', 'LOBOS C√ÅCERES ANTONIA PAZ', 'MART√çNEZ LIZANA AARON ALEJANDRO', 'MEZA CARRASCO BENJAM√çN INTI', 'MI√ëO GONZALEZ CATALINA ANDREA', 'P√âREZ COR√ìN MANUEL IGNACIO', 'SAMANIEGO CORTEZ JAKSON FERGIE', 'SEP√öLVEDA SALAZAR SOF√çA ANTONIA', 'TAPIA ACU√ëA GABRIEL ANTONIO', 'TORREALBA MOYA FLORVELIS DE LOS ANGELES', 'VEGA VIVANCO CRIST√ìBAL ANTONIO', 'VERA NAVARRETE DANIELA ELIZABETH', 'VILLALOBOS ARAVENA KARINA ANGELINA', 'VILLALOBOS VILLALOBOS SAMIR LUCIAN JES√öS'],
            'Cuarto Medio C': ['ARELLANO ACU√ëA MART√çN ANTONIO', 'AROS √ÅVILA DAYANA IGNACIA', 'CABRERA COLOMBINO MAR√çA GRACIA', 'COLLAO MEDINA ANA√çS VALENTINA', 'DE LA HOZ VALENZUELA FRANCO SEBASTI√ÅN', 'FUENTES CARRASCO YARIXA ALEJANDRA', 'G√ìMEZ CANCINO DANIELA ALEJANDRA', 'GUTI√âRREZ CARRI√ìN MILLARAY CAROLINA', 'HONORATO TAPIA GLORIA JAVIERA', 'LARA RIVERA BENJAM√çN ESTEBAN', 'PALACIOS SOTO JOS√â TOM√ÅS', 'PEZO SANTANDER JOS√â CRIST√ìBAL', 'ROCHA ROJAS JOS√â PABLO WILLIAMS', 'ROJAS Y√âVENES FABIANA ISIDORA', 'S√ÅNCHEZ PAREJA ANDY ANTONIO', 'SANTANDER L√ìPEZ SIM√ìN ESTEBAN', 'TRONCOSO LIZAMA SIOMARA IGNACIA', 'WARNKEN ROJAS LUCIANA BERNABELA']
        };

        const courseSelect = document.getElementById('course-select');
        const studentSelect = document.getElementById('student-select');
        const dateInput = document.getElementById('reg-date');
        let dailyRecords = [];

        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar Auth
            signInAnonymously(auth).then(() => {
                console.log("Conectado");
                listenDailyRecords();
            });

            // Llenar Cursos
            for(const course in schoolData) {
                const opt = document.createElement('option'); opt.value = course; opt.textContent = course;
                courseSelect.appendChild(opt);
            }

            // Fecha hoy
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;
            
            // Re-escuchar si cambia la fecha
            dateInput.addEventListener('change', listenDailyRecords);
        });

        courseSelect.addEventListener('change', () => {
            const course = courseSelect.value;
            studentSelect.innerHTML = '<option value="">-- Seleccionar --</option>';
            studentSelect.disabled = !course;
            if(course && schoolData[course]) {
                schoolData[course].forEach(s => {
                    const opt = document.createElement('option'); opt.value = s; opt.textContent = s;
                    studentSelect.appendChild(opt);
                });
            }
        });

        // ESCUCHAR REGISTROS
        function listenDailyRecords() {
            const dateStr = dateInput.value;
            const q = query(collection(db, COLLECTION_NAME), where("dateStr", "==", dateStr));
            
            onSnapshot(q, (snapshot) => {
                dailyRecords = [];
                snapshot.forEach(doc => dailyRecords.push({id: doc.id, ...doc.data()}));
                // Ordenar m√°s reciente arriba
                dailyRecords.sort((a,b) => b.createdAt.seconds - a.createdAt.seconds);
                renderTable();
            });
        }

        // GUARDAR REGISTRO
        document.getElementById('btn-save').addEventListener('click', async () => {
            const course = courseSelect.value;
            const student = studentSelect.value;
            const dateStr = dateInput.value;
            const obs = document.getElementById('obs-text').value.trim();
            
            // Recopilar checkboxes
            const infractions = [];
            document.querySelectorAll('.item-check:checked').forEach(chk => infractions.push(chk.value));

            if(!course || !student || infractions.length === 0) {
                return showToast("‚ö†Ô∏è Selecciona alumno y al menos una infracci√≥n.");
            }

            const record = {
                course, student, dateStr, obs, infractions,
                createdAt: Timestamp.now()
            };

            try {
                await addDoc(collection(db, COLLECTION_NAME), record);
                printTicket(record); // Imprimir inmediatamente
                
                // Reset UI parcial
                document.querySelectorAll('.item-check:checked').forEach(chk => chk.checked = false);
                document.getElementById('obs-text').value = "";
                showToast("‚úÖ Registro guardado e impreso.");
            } catch(e) {
                console.error(e);
                showToast("‚ùå Error al guardar.");
            }
        });

        function renderTable() {
            const tbody = document.getElementById('report-body');
            document.getElementById('count-badge').innerText = dailyRecords.length;
            tbody.innerHTML = '';
            
            if(dailyRecords.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-gray-400">Sin registros hoy.</td></tr>';
                return;
            }

            dailyRecords.forEach(r => {
                const faults = r.infractions.join(", ");
                tbody.innerHTML += `
                    <tr class="hover:bg-gray-50 border-b">
                        <td class="p-2">
                            <div class="font-bold text-gray-800 text-xs">${r.student}</div>
                            <div class="text-[10px] text-gray-500">${r.course}</div>
                        </td>
                        <td class="p-2 text-xs text-orange-700 leading-tight">${faults}</td>
                        <td class="p-2 text-right">
                             <button onclick="window.deleteItem('${r.id}')" class="text-red-500 hover:bg-red-50 p-1 rounded font-bold">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
        }

        // IMPRIMIR TICKET (COLILLA)
        function printTicket(data) {
            const area = document.getElementById('printable-area');
            const now = new Date();
            
            area.innerHTML = `
                <div class="ticket-header">
                    <img src="logo.jpg" style="height:40px; margin-bottom:5px;" onerror="this.style.display='none'">
                    <div class="ticket-title">Control de Uniforme</div>
                    <div style="font-size:10px;">Escuela Agr√≠cola Sagrados Corazones</div>
                </div>
                
                <div class="ticket-line"></div>
                
                <div class="ticket-info"><strong>FECHA:</strong> ${data.dateStr}</div>
                <div class="ticket-info"><strong>ALUMNO:</strong> ${data.student}</div>
                <div class="ticket-info"><strong>CURSO:</strong> ${data.course}</div>
                
                <div class="ticket-line"></div>
                
                <div style="font-weight:bold; font-size:11px; margin-top:5px;">INFRACCIONES DETECTADAS:</div>
                <ul class="ticket-items" style="padding-left:15px; margin-top:2px;">
                    ${data.infractions.map(i => `<li>${i}</li>`).join('')}
                </ul>
                
                ${data.obs ? `<div style="font-size:11px; margin-top:5px;"><strong>Obs:</strong> ${data.obs}</div>` : ''}
                
                <div class="ticket-footer">
                    <div style="border-top:1px solid #000; width:80%; margin:20px auto 5px auto;"></div>
                    Firma Inspector√≠a<br>
                    <span style="font-size:9px; color:#666;">Documento Interno</span>
                </div>
            `;
            
            // Estilo espec√≠fico para forzar colilla
            const style = document.createElement('style');
            style.innerHTML = `@media print { @page { size: 80mm auto; margin: 0; } body { background: white; } }`;
            document.head.appendChild(style);
            
            window.print();
            
            setTimeout(() => document.head.removeChild(style), 1000);
        }

        // IMPRIMIR REPORTE TABLA
        window.printReport = () => {
            const area = document.getElementById('printable-area');
            const dateStr = dateInput.value;
            
            area.innerHTML = `
                <h2 style="text-align:center; font-family:Arial;">REPORTE DE UNIFORME</h2>
                <p style="text-align:center; font-family:Arial; font-size:12px;">Fecha: ${dateStr} | Total Casos: ${dailyRecords.length}</p>
                <table style="width:100%; border-collapse:collapse; font-family:Arial; font-size:11px; margin-top:20px;">
                    <thead>
                        <tr style="background:#eee;">
                            <th style="border:1px solid #999; padding:5px; text-align:left;">Curso</th>
                            <th style="border:1px solid #999; padding:5px; text-align:left;">Alumno</th>
                            <th style="border:1px solid #999; padding:5px; text-align:left;">Faltas</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${dailyRecords.map(r => `
                            <tr>
                                <td style="border:1px solid #999; padding:5px;">${r.course}</td>
                                <td style="border:1px solid #999; padding:5px;">${r.student}</td>
                                <td style="border:1px solid #999; padding:5px;">${r.infractions.join(', ')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            // Estilo para reporte hoja carta
            const style = document.createElement('style');
            style.innerHTML = `@media print { @page { size: Letter; margin: 1cm; } #printable-area { width: 100% !important; position: static !important; } }`;
            document.head.appendChild(style);
            
            window.print();
            
            setTimeout(() => document.head.removeChild(style), 1000);
        };

        window.deleteItem = async (id) => {
            if(confirm("¬øBorrar este registro?")) {
                await deleteDoc(doc(db, COLLECTION_NAME, id));
                showToast("Registro eliminado");
            }
        };

        function showToast(msg) {
            const box = document.getElementById('message-box');
            box.innerText = msg;
            box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 3000);
        }
    </script>
</body>
</html>